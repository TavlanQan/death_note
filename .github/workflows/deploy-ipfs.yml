name: ðŸš€ Deploy to IPFS via Filebase

on:
  push:
    branches: ["main"]
  workflow_dispatch:  # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· GitHub UI

env:
  FILEBASE_BUCKET: "dxn-front"
  FILEBASE_ENDPOINT: "https://s3.filebase.com"

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    # Ð¨Ð°Ð³ 1: ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð´ Ð¸Ð· Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
    
    # Ð¨Ð°Ð³ 2: Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Node.js
    - name: âš™ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
    
    # Ð¨Ð°Ð³ 3: Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
    - name: ðŸ“¦ Install dependencies
      run: |
        npm ci
        # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ jq Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ JSON
        sudo apt-get update && sudo apt-get install -y jq
    
    # Ð¨Ð°Ð³ 4: Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚
    - name: ðŸ—ï¸ Build project
      run: npm run build
    
    # Ð¨Ð°Ð³ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ±Ð¾Ñ€ÐºÑƒ
    - name: ðŸ” Verify build
      run: |
        echo "ðŸ“ Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ð¿Ð°Ð¿ÐºÐ¸ out:"
        ls -la out/
        echo "ðŸ“Š Ð Ð°Ð·Ð¼ÐµÑ€ Ð¿Ð°Ð¿ÐºÐ¸:"
        du -sh out/
    
    # Ð¨Ð°Ð³ 6: Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ AWS CLI (Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ S3 API Filebase)
    - name: ðŸ”§ Install AWS CLI
      run: |
        echo "Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÑŽ AWS CLI..."
        curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
        unzip -q awscliv2.zip
        sudo ./aws/install --update
        echo "âœ… AWS CLI ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½:"
        aws --version
    
    # Ð¨Ð°Ð³ 7: ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ AWS CLI Ð´Ð»Ñ Filebase
    - name: ðŸ” Configure AWS CLI for Filebase
      run: |
        echo "ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÑŽ AWS CLI Ð´Ð»Ñ Filebase..."
        aws configure set aws_access_key_id ${{ secrets.FILEBASE_ACCESS_KEY }}
        aws configure set aws_secret_access_key ${{ secrets.FILEBASE_SECRET_KEY }}
        aws configure set default.region us-east-1
        aws configure set default.s3.max_concurrent_requests 5
        aws configure set default.s3.max_queue_size 1000
        aws configure set default.s3.multipart_threshold 64MB
        aws configure set default.s3.multipart_chunksize 16MB
        aws configure set default.s3.use_accelerate_endpoint false
        aws configure set default.s3.addressing_style virtual
        echo "âœ… ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"
    
    # Ð¨Ð°Ð³ 8: Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð¼Ñ Ð´Ð»Ñ Ð¿Ð°Ð¿ÐºÐ¸ ÑÐ±Ð¾Ñ€ÐºÐ¸
    - name: ðŸ·ï¸ Generate unique folder name
      id: folder-name
      run: |
        TIMESTAMP=$(date +%Y%m%d-%H%M%S)
        COMMIT_HASH=$(git rev-parse --short HEAD)
        FOLDER_NAME="build-${TIMESTAMP}-${COMMIT_HASH}"
        echo "ðŸ“ Ð˜Ð¼Ñ Ð¿Ð°Ð¿ÐºÐ¸: ${FOLDER_NAME}"
        echo "FOLDER_NAME=${FOLDER_NAME}" >> $GITHUB_ENV
        echo "folder=${FOLDER_NAME}" >> $GITHUB_OUTPUT
    
    # Ð¨Ð°Ð³ 9: Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ out Ð² Filebase Ñ‡ÐµÑ€ÐµÐ· S3
    - name: ðŸ“¤ Upload to Filebase S3
      id: upload
      run: |
        echo "ðŸ”„ ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð² Filebase S3..."
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿ÑƒÑ‚ÑŒ Ð² S3
        S3_PATH="s3://${{ env.FILEBASE_BUCKET }}/${{ env.FOLDER_NAME }}/"
        echo "ðŸ“¤ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽ Ð²: $S3_PATH"
        echo "ðŸŒ Endpoint: ${{ env.FILEBASE_ENDPOINT }}"
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ S3
        echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑŽ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°ÐºÐµÑ‚Ð°..."
        aws s3 ls "s3://${{ env.FILEBASE_BUCKET }}" --endpoint-url "${{ env.FILEBASE_ENDPOINT }}" || echo "Ð‘Ð°ÐºÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"
        
        # Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ out Ñ Filebase (Ñ€ÐµÐºÑƒÑ€ÑÐ¸Ð²Ð½Ð¾ ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÐ¼ Ð²ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹)
        echo "ðŸ“‚ ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ..."
        aws s3 sync ./out/ "$S3_PATH" \
          --endpoint-url "${{ env.FILEBASE_ENDPOINT }}" \
          --acl public-read \
          --no-progress
        
        echo "âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!"
        echo "ðŸ“ Ð¤Ð°Ð¹Ð»Ñ‹ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð²: $S3_PATH"
        
        # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ
        echo "S3_PATH=$S3_PATH" >> $GITHUB_ENV
    
    # Ð¨Ð°Ð³ 10: ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ CID Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ð¾Ð¹ Ð¿Ð°Ð¿ÐºÐ¸ Ñ‡ÐµÑ€ÐµÐ· Filebase API
    - name: ðŸ†” Get CID from Filebase API
      id: get-cid
      run: |
        echo "ðŸ” ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÑŽ CID Ñ‡ÐµÑ€ÐµÐ· Filebase API..."
        
        # ÐœÐµÑ‚Ð¾Ð´ 1: ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· S3 Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ
        echo "ðŸ”„ ÐœÐµÑ‚Ð¾Ð´ 1: ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÑŽ Ñ‡ÐµÑ€ÐµÐ· S3 API..."
        
        # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ CID Ñ‡ÐµÑ€ÐµÐ· S3 API (Ð±Ð¾Ð»ÐµÐµ Ð½Ð°Ð´ÐµÐ¶Ð½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±)
        echo "ðŸ”Ž Ð˜Ñ‰Ñƒ Ñ„Ð°Ð¹Ð»Ñ‹ Ð² Ð¿Ð°Ð¿ÐºÐµ ${{ env.FOLDER_NAME }}..."
        
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð² Ð¿Ð°Ð¿ÐºÐµ
        FILES_LIST=$(aws s3 ls "s3://${{ env.FILEBASE_BUCKET }}/${{ env.FOLDER_NAME }}/" \
          --endpoint-url "${{ env.FILEBASE_ENDPOINT }}" \
          --recursive)
        
        if [ -z "$FILES_LIST" ]; then
          echo "âŒ Ð¤Ð°Ð¹Ð»Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð² S3"
        else
          echo "ðŸ“„ ÐÐ°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹:"
          echo "$FILES_LIST"
          
          # Ð‘ÐµÑ€ÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
          FIRST_FILE=$(echo "$FILES_LIST" | head -1 | awk '{print $4}')
          echo "ðŸ“„ ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»: $FIRST_FILE"
        fi
        
        # ÐœÐµÑ‚Ð¾Ð´ 2: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Filebase API Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¾Ð¹
        echo ""
        echo "ðŸ”„ ÐœÐµÑ‚Ð¾Ð´ 2: ÐŸÑ€Ð¾Ð±ÑƒÑŽ Filebase REST API..."
        
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ñ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ñ‹Ð¼ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼
        echo "ðŸ” Ð—Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÑŽ Ñ‚Ð¾ÐºÐµÐ½ Ñƒ Filebase..."
        
        AUTH_RESPONSE=$(curl -s -v -X POST https://api.filebase.io/v1/account/auth \
          -u "${{ secrets.FILEBASE_ACCESS_KEY }}:${{ secrets.FILEBASE_SECRET_KEY }}" 2>&1)
        
        echo "ðŸ“„ Ð¡Ñ‹Ñ€Ð¾Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸:"
        echo "$AUTH_RESPONSE"
        
        # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ ÑÐ¿Ð¾ÑÐ¾Ð±Ð°Ð¼Ð¸
        TOKEN=$(echo "$AUTH_RESPONSE" | grep -i "token" | grep -o '"token":"[^"]*"' | cut -d'"' -f4)
        
        if [ -z "$TOKEN" ]; then
          TOKEN=$(echo "$AUTH_RESPONSE" | grep -o '"token":"[^"]*"' | cut -d'"' -f4)
        fi
        
        if [ -z "$TOKEN" ]; then
          # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð· JSON, ÐµÑÐ»Ð¸ Ð¾Ñ‚Ð²ÐµÑ‚ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ JSON
          if command -v jq &> /dev/null; then
            TOKEN=$(echo "$AUTH_RESPONSE" | jq -r '.token' 2>/dev/null || true)
          fi
        fi
        
        echo "ðŸ”‘ Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½: $TOKEN"
        
        if [ -z "$TOKEN" ]; then
          echo "âš ï¸ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚Ð¾ÐºÐµÐ½, Ð¿Ñ€Ð¾Ð±ÑƒÑŽ Ð°Ð»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´..."
          
          # ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿Ñ€ÑÐ¼Ð¾Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð±ÐµÐ· Ñ‚Ð¾ÐºÐµÐ½Ð°
          echo "ðŸ”„ ÐœÐµÑ‚Ð¾Ð´ 3: ÐŸÑ€ÑÐ¼Ð¾Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº CID Ñ‡ÐµÑ€ÐµÐ· S3 Head Object..."
          
          # Ð‘ÐµÑ€ÐµÐ¼ Ð»ÑŽÐ±Ð¾Ð¹ Ñ„Ð°Ð¹Ð» Ð¸Ð· Ð¿Ð°Ð¿ÐºÐ¸
          if [ ! -z "$FIRST_FILE" ]; then
            echo "ðŸ“„ ÐŸÑ€Ð¾Ð±ÑƒÑŽ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ CID Ð´Ð»Ñ Ñ„Ð°Ð¹Ð»Ð°: $FIRST_FILE"
            
            # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ð°
            HEAD_RESPONSE=$(aws s3api head-object \
              --bucket "${{ env.FILEBASE_BUCKET }}" \
              --key "$FIRST_FILE" \
              --endpoint-url "${{ env.FILEBASE_ENDPOINT }}" \
              2>&1 || true)
            
            echo "ðŸ“„ ÐžÑ‚Ð²ÐµÑ‚ S3 Head Object:"
            echo "$HEAD_RESPONSE"
            
            # Ð˜Ñ‰ÐµÐ¼ CID Ð² Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…
            CID=$(echo "$HEAD_RESPONSE" | grep -o '"cid":"[^"]*"' | cut -d'"' -f4)
            
            if [ -z "$CID" ]; then
              CID=$(echo "$HEAD_RESPONSE" | grep -o 'Qm[1-9A-HJ-NP-Za-km-z]\{44,\}' | head -1)
            fi
          fi
        else
          # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½
          echo "âœ… Ð¢Ð¾ÐºÐµÐ½ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½, Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÑŽ CID..."
          
          # Ð–Ð´ÐµÐ¼ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²
          sleep 5
          
          # ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð±: Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ API Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²
          LIST_RESPONSE=$(curl -s -X GET \
            "https://api.filebase.io/v1/ipfs/buckets/${{ env.FILEBASE_BUCKET }}/keys?limit=10" \
            -H "Authorization: Bearer $TOKEN")
          
          echo "ðŸ“„ ÐžÑ‚Ð²ÐµÑ‚ ÑÐ¿Ð¸ÑÐºÐ° Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² (Ð¿ÐµÑ€Ð²Ñ‹Ðµ 1000 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²):"
          echo "${LIST_RESPONSE:0:1000}"
          
          # Ð˜Ñ‰ÐµÐ¼ Ð½Ð°ÑˆÑƒ Ð¿Ð°Ð¿ÐºÑƒ Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ðµ
          FOLDER_NAME="${{ env.FOLDER_NAME }}"
          CID=$(echo "$LIST_RESPONSE" | grep -o "\"name\":\"${FOLDER_NAME}/[^\"]*\".*\"cid\":\"[^\"]*\"" | head -1 | grep -o '"cid":"[^"]*"' | cut -d'"' -f4)
          
          if [ -z "$CID" ]; then
            # ÐŸÑ€Ð¾Ð±ÑƒÐµÐ¼ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¿Ð¾Ð¸ÑÐºÐ°
            CID=$(echo "$LIST_RESPONSE" | grep -o '"cid":"[^"]*"' | head -1 | cut -d'"' -f4)
          fi
        fi
        
        # ÐœÐµÑ‚Ð¾Ð´ 4: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Filebase Ð²ÐµÐ±-API Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ
        if [ -z "$CID" ]; then
          echo ""
          echo "ðŸ”„ ÐœÐµÑ‚Ð¾Ð´ 4: ÐŸÑ€ÑÐ¼Ð¾Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ Filebase..."
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Python ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ CID
          cat > get_cid.py << 'EOF'
import os
import requests
import json
import time

# ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
ACCESS_KEY = os.environ.get('FILEBASE_ACCESS_KEY')
SECRET_KEY = os.environ.get('FILEBASE_SECRET_KEY')
BUCKET = os.environ.get('FILEBASE_BUCKET')
FOLDER = os.environ.get('FOLDER_NAME')

print(f"Ð˜Ñ‰Ñƒ CID Ð´Ð»Ñ Ð¿Ð°Ð¿ÐºÐ¸: {FOLDER}")
print(f"Ð‘Ð°ÐºÐµÑ‚: {BUCKET}")

# 1. ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½
try:
    auth_response = requests.post(
        'https://api.filebase.io/v1/account/auth',
        auth=(ACCESS_KEY, SECRET_KEY),
        timeout=30
    )
    print(f"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸: {auth_response.status_code}")
    print(f"Ð¢ÐµÐºÑÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚Ð°: {auth_response.text}")
    
    if auth_response.status_code == 200:
        token = auth_response.json().get('token')
        if token:
            print(f"Ð¢Ð¾ÐºÐµÐ½ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½: {token[:20]}...")
            
            # 2. ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² Ð² Ð±Ð°ÐºÐµÑ‚Ðµ
            time.sleep(3)
            
            list_response = requests.get(
                f'https://api.filebase.io/v1/ipfs/buckets/{BUCKET}/keys',
                headers={'Authorization': f'Bearer {token}'},
                timeout=30
            )
            
            print(f"Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÐ¿Ð¸ÑÐºÐ° Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²: {list_response.status_code}")
            
            if list_response.status_code == 200:
                objects = list_response.json().get('objects', [])
                print(f"ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²: {len(objects)}")
                
                # Ð˜Ñ‰ÐµÐ¼ Ð½Ð°ÑˆÑƒ Ð¿Ð°Ð¿ÐºÑƒ
                for obj in objects:
                    name = obj.get('name', '')
                    if name.startswith(f'{FOLDER}/'):
                        cid = obj.get('cid')
                        if cid:
                            print(f"ÐÐ°Ð¹Ð´ÐµÐ½ CID: {cid}")
                            print(f"::set-output name=cid::{cid}")
                            exit(0)
                
                print("ÐŸÐ°Ð¿ÐºÐ° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð² ÑÐ¿Ð¸ÑÐºÐµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð²")
            else:
                print(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ°: {list_response.text}")
        else:
            print("Ð¢Ð¾ÐºÐµÐ½ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð² Ð¾Ñ‚Ð²ÐµÑ‚Ðµ")
    else:
        print(f"ÐžÑˆÐ¸Ð±ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸: {auth_response.text}")
except Exception as e:
    print(f"Ð˜ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ: {str(e)}")

print("CID Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ñ‡ÐµÑ€ÐµÐ· API")
EOF
          
          # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Python ÑÐºÑ€Ð¸Ð¿Ñ‚
          python3 get_cid.py || true
        fi
        
        # ÐœÐµÑ‚Ð¾Ð´ 5: Ð•ÑÐ»Ð¸ CID Ð²ÑÐµ ÐµÑ‰Ðµ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½
        if [ -z "$CID" ]; then
          echo ""
          echo "âŒ CID Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸"
          echo "ðŸ“ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ Ð Ð£Ð§ÐÐžÐ“Ðž ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð¯:"
          echo ""
          echo "1. Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² Filebase: https://console.filebase.com"
          echo "2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð±Ð°ÐºÐµÑ‚ 'dxn-front'"
          echo "3. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ: ${{ env.FOLDER_NAME }}"
          echo "4. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ð°Ð¿ÐºÑƒ â†’ Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ CID Ð¸Ð· Ð°Ð´Ñ€ÐµÑÐ½Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð¸Ð»Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ Ð¿Ð°Ð¿ÐºÐµ"
          echo "5. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² 'IPNS Keys'"
          echo "6. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ 'deathnote'"
          echo "7. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Update' Ð¸ Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ CID"
          echo ""
          echo "ðŸ“Œ ÐŸÑ€Ð¸Ð¼ÐµÑ€:"
          echo "   Ð¡ÑÑ‹Ð»ÐºÐ° Ð±ÑƒÐ´ÐµÑ‚ Ð²Ñ‹Ð³Ð»ÑÐ´ÐµÑ‚ÑŒ Ñ‚Ð°Ðº:"
          echo "   https://console.filebase.com/buckets/dxn-front?prefix=build-20240101-120000-abc123/"
          echo "   CID Ð±ÑƒÐ´ÐµÑ‚ Ð² Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ Ð¿Ð°Ð¿ÐºÐµ: QmXyz..."
          
          echo "CID_NOT_FOUND=true" >> $GITHUB_ENV
          echo "cid=none" >> $GITHUB_OUTPUT
        else
          echo ""
          echo "ðŸŽ‰ Ð£Ð¡ÐŸÐ•Ð¥! CID Ð½Ð°Ð¹Ð´ÐµÐ½: $CID"
          echo "cid=$CID" >> $GITHUB_OUTPUT
          echo "IPFS_CID=$CID" >> $GITHUB_ENV
          
          # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ CID Ð² Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… ÑˆÐ°Ð³Ð°Ñ…
          echo "$CID" > /tmp/ipfs_cid.txt
        fi    
    
    # Ð¨Ð°Ð³ 11: ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ IPNS Ð·Ð°Ð¿Ð¸ÑÑŒ (ÐµÑÐ»Ð¸ CID Ð½Ð°Ð¹Ð´ÐµÐ½)
    - name: ðŸ”— Update IPNS record
      if: env.IPFS_CID != ''
      run: |
        echo "ðŸ”„ ÐŸÑ€Ð¾Ð±ÑƒÑŽ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ IPNS Ð·Ð°Ð¿Ð¸ÑÑŒ..."
        
        CID="${{ env.IPFS_CID }}"
        IPNS_KEY_NAME="${{ secrets.IPFS_KEY_NAME }}"
        
        echo "ðŸ”‘ IPNS ÐºÐ»ÑŽÑ‡: $IPNS_KEY_NAME"
        echo "ðŸ“¦ CID: $CID"
        
        echo "ðŸ“ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ IPNS Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ðµ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· API"
        echo "ðŸ“‹ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ IPNS Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Filebase:"
        echo ""
        echo "1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ https://console.filebase.com"
        echo "2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² 'IPNS Keys' Ð² Ð»ÐµÐ²Ð¾Ð¼ Ð¼ÐµÐ½ÑŽ"
        echo "3. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ '$IPNS_KEY_NAME'"
        echo "4. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Update'"
        echo "5. Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ CID: $CID"
        echo "6. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Update Record'"
        echo ""
        echo "ðŸŒ ÐŸÐ¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ ÑÐ°Ð¹Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð¿Ð¾:"
        echo "   - https://deathnote.rip"
        echo "   - https://ipfs.filebase.io/ipns/k51qzi5uqu5dlnkeibe66l3ccybqkyh244erdfm5nk12q6njyh8686llnusri9"
        echo ""
        echo "â±ï¸ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¹Ð¼ÐµÑ‚ 1-5 Ð¼Ð¸Ð½ÑƒÑ‚"
    
    # Ð¨Ð°Ð³ 12: Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ (ÐµÑÐ»Ð¸ CID Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½)
    - name: ðŸ“ Manual update instructions
      if: env.CID_NOT_FOUND == 'true'
      run: |
        echo "âŒ CID Ð½Ðµ Ð±Ñ‹Ð» Ð½Ð°Ð¹Ð´ÐµÐ½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸"
        echo ""
        echo "ðŸ“‹ Ð˜ÐÐ¡Ð¢Ð Ð£ÐšÐ¦Ð˜Ð¯ Ð”Ð›Ð¯ Ð Ð£Ð§ÐÐžÐ“Ðž ÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð¯:"
        echo ""
        echo "1. Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² Filebase: https://console.filebase.com"
        echo "2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð±Ð°ÐºÐµÑ‚ 'dxn-front'"
        echo "3. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ: ${{ env.FOLDER_NAME }}"
        echo "4. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ð°Ð¿ÐºÑƒ â†’ 'Copy CID'"
        echo "5. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² 'IPNS Keys'"
        echo "6. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ 'deathnote'"
        echo "7. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ 'Update' Ð¸ Ð²ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ CID"
        echo ""
        echo "ÐŸÐ¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð²Ð°Ñˆ ÑÐ°Ð¹Ñ‚ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· 1-5 Ð¼Ð¸Ð½ÑƒÑ‚"
    
    # Ð¨Ð°Ð³ 13: ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÑ‚Ð°Ñ€Ñ‹Ñ… ÑÐ±Ð¾Ñ€Ð¾Ðº (Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 3)
    - name: ðŸ§¹ Cleanup old deployments
      if: success() && env.CID_NOT_FOUND != 'true'
      run: |
        echo "ðŸ§¹ ÐžÑ‡Ð¸Ñ‰Ð°ÑŽ ÑÑ‚Ð°Ñ€Ñ‹Ðµ ÑÐ±Ð¾Ñ€ÐºÐ¸..."
        
        # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… Ð¿Ð°Ð¿Ð¾Ðº ÑÐ±Ð¾Ñ€Ð¾Ðº
        FOLDERS=$(aws s3 ls "s3://${{ env.FILEBASE_BUCKET }}/" \
          --endpoint-url "${{ env.FILEBASE_ENDPOINT }}" \
          | grep "build-" \
          | awk '{print $2}' \
          | sort -r)
        
        # Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾
        COUNT=$(echo "$FOLDERS" | wc -l)
        echo "ðŸ“Š ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ $COUNT ÑÐ±Ð¾Ñ€Ð¾Ðº"
        
        if [ $COUNT -gt 3 ]; then
          echo "ðŸ—‘ï¸ Ð£Ð´Ð°Ð»ÑÑŽ ÑÑ‚Ð°Ñ€Ñ‹Ðµ ÑÐ±Ð¾Ñ€ÐºÐ¸ (Ð¾ÑÑ‚Ð°Ð²Ð»ÑÑŽ 3 Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ)..."
          TO_DELETE=$(echo "$FOLDERS" | tail -n +4)
          
          for FOLDER in $TO_DELETE; do
            echo "Ð£Ð´Ð°Ð»ÑÑŽ: $FOLDER"
            aws s3 rm "s3://${{ env.FILEBASE_BUCKET }}/$FOLDER" \
              --recursive \
              --endpoint-url "${{ env.FILEBASE_ENDPOINT }}" \
              || echo "âš ï¸ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ $FOLDER"
          done
          echo "âœ… ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"
        else
          echo "âœ… ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ (Ð¼ÐµÐ½ÑŒÑˆÐµ 4 ÑÐ±Ð¾Ñ€Ð¾Ðº)"
        fi

    # Ð¨Ð°Ð³ 14: Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¾Ñ‚Ñ‡ÐµÑ‚ Ð¾ Ð´ÐµÐ¿Ð»Ð¾Ðµ
    - name: ðŸ“Š Create deployment summary
      if: always()
      run: |
        echo "## ðŸš€ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð´ÐµÐ¿Ð»Ð¾Ñ" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        if ${{ job.status == 'success' }}; then
          if [ "${{ env.CID_NOT_FOUND }}" = "true" ]; then
            echo "âš ï¸ **Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½, Ð½Ð¾ CID Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**ðŸ“ ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ:**" >> $GITHUB_STEP_SUMMARY
            echo "1. Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ Ð² [Filebase](https://console.filebase.com)" >> $GITHUB_STEP_SUMMARY
            echo "2. ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² Ð±Ð°ÐºÐµÑ‚ **dxn-front**" >> $GITHUB_STEP_SUMMARY
            echo "3. ÐÐ°Ð¹Ð´Ð¸Ñ‚Ðµ Ð¿Ð°Ð¿ÐºÑƒ **${{ env.FOLDER_NAME }}**" >> $GITHUB_STEP_SUMMARY
            echo "4. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ CID Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ IPNS ÐºÐ»ÑŽÑ‡ **deathnote**" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… **Ð”ÐµÐ¿Ð»Ð¾Ð¹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½!**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**ðŸŒ Ð¡ÑÑ‹Ð»ÐºÐ¸ Ð½Ð° ÑÐ°Ð¹Ñ‚:**" >> $GITHUB_STEP_SUMMARY
            echo "- [deathnote.rip](https://deathnote.rip)" >> $GITHUB_STEP_SUMMARY
            echo "- [IPNS Ñ‡ÐµÑ€ÐµÐ· Filebase](https://ipfs.filebase.io/ipns/k51qzi5uqu5dlnkeibe66l3ccybqkyh244erdfm5nk12q6njyh8686llnusri9)" >> $GITHUB_STEP_SUMMARY
            echo "- [ÐŸÑ€ÑÐ¼Ð¾Ð¹ IPFS Ð´Ð¾ÑÑ‚ÑƒÐ¿](https://${{ env.IPFS_CID }}.ipfs.dweb.link)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**ðŸ“¦ CID Ð½Ð¾Ð²Ð¾Ð¹ ÑÐ±Ð¾Ñ€ÐºÐ¸:**" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "${{ env.IPFS_CID }}" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "**ðŸ“ Ð˜Ð¼Ñ Ð¿Ð°Ð¿ÐºÐ¸ Ð² Filebase:** \`${{ env.FOLDER_NAME }}\`" >> $GITHUB_STEP_SUMMARY
          fi
        else
          echo "âŒ **Ð”ÐµÐ¿Ð»Ð¾Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ð»ÑÑ Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ¾Ð¹**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð²Ñ‹ÑˆÐµ Ð´Ð»Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹." >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "*Ð—Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾: $(date)*" >> $GITHUB_STEP_SUMMARY
